<% title "Tabela Transportowa" %>

<div class="section list">
  <h1>Tabela Transportowa</h1>
</div>
 <br/>
<p>
<b>Pobierz listę w formacie: 
<%= button_to("Excel (.xls)" , export_tabela_transportowa_path(format: "xls"), :class => "szczegoly") %>

</b>
</p>
<br/>
<div id="tabela-div">
  
<table  border="1"class="listing" summary="Section list">
    <tr class="header">
      <th>Nr. drogi</th>
      <th>Nr. z systemu</th>
      <th>Przebieg trasy</th>
      <th>Opis trasy</th>
      <th>Typ operacji</th>
      <th>Obszar</th>
      <th>Ruch od</th>
      <th>Ruch do</th>
      <th>Środek transporu</th>
      <th>Dystans od</th>
      <th>Dystans do</th>
      <th>Ilość zakrętów</th>
      <th>Ilość start/stop</th>
      <th>Rodzaj pobrania</th>
      <th>Komentarz</th>
      <th>Kod prędkości</th>
      <th>Pochodzenie</th>
      <th>Czas przejazdu bez pobrania <br/>i umiesczenia [sek/1kurs]</th>
      <th>Data dodania</th>



      <th>Data dodania</th>
    </tr>
 <% @transporty.each do |transport| %>
 <tr >
      <% @predkosc_kod_km = predkosc_po_kodzie(transport.tt_predkosc_kod)[0]
         @predkosc_kod_m = (1/(@predkosc_kod_km*10/36)).to_f
         @dodatek_czas_zakr ||=  dodatek_po_kodzie(transport.tt_srodek_transportu)[0].to_f
         @dodatek_czas_start_stop ||=  dodatek_start_po_kodzie(transport.tt_srodek_transportu)[0].to_f

      %>
      <td><%= transport.tt_nr_drogi %></td>
      <td><%= transport.tt_nr_drogi_system %></td>
      <td><%= transport.tt_przebieg_trasy %></td>
      <td><%= transport.tt_opis_trasy %></td>
      <td><%= transport.tt_typ_operacji %></td>
      <td><%= transport.tt_obszar %></td>
      <td><%= transport.tt_ruch_od %></td>
      <td><%= transport.tt_ruch_do %></td>
      <td><%= transport.tt_srodek_transportu %></td>
      <td><%= transport.tt_dystans_od.to_f.round(2) %></td>
      <td><%= transport.tt_dystans_do.to_f.round(2) %></td>
      <td><%= transport.tt_ilosc_zakretow %></td>
      <td><%= transport.tt_ilosc_start_stop %></td>
      <td><%= transport.tt_rodzaj_pobrania %></td>
      <td><%= transport.tt_komentarz %></td>
      <td><%= transport.tt_predkosc_kod %></td>
      <td><%= transport.tt_import_file_info %>

      <% if (transport.tt_dystans_od.to_f + transport.tt_dystans_do.to_f) > 0  %>

      <td><%= ((transport.tt_dystans_od.to_f + transport.tt_dystans_do.to_f) * @predkosc_kod_m  +
              
              (
                if transport.tt_ilosc_zakretow == nil || @dodatek_czas_zakr == nil 
                  0
              else
                  (transport.tt_ilosc_zakretow.to_i * @dodatek_czas_zakr)  
              end 

              +

              if transport.tt_ilosc_zakretow == nil || @dodatek_czas_zakr == nil 
                  0
              else
                   (transport.tt_ilosc_start_stop.to_i * @dodatek_czas_start_stop)
              end
              )
              ).round(2)

      %>
      

        <% end %>

      <td><%= transport.created_at.strftime("%d-%m-%Y") %>
      <% if permitted_to? :delete, :tabelatransportowas %>
        <td><%= button_to("usuń", usun_po_id_transport_path(transport.id), :class=>"szczegoly" ) %></td>
      <% end %>
      </tr>
          
     <% end %>




   </table>
</div>
     <div id="insert" >
  <p>Dodaj nowy Transport:</p>

 <%= form_for @nowy_transport do |f| %>
  
    <%= render(:partial => 'form', :locals => {:f => f}) %>
    
    
  <% end %>